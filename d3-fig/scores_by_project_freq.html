<!DOCTYPE html>
<meta charset="utf-8">
<style>

</style>
<script src="js/plotly.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300&display=swap" rel="stylesheet">
<body>
    <div class="violinplot" data-num="0">
        <div class="plot" id="myplot"></div>
        </div>
    </div>
</body>
<script>
    Plotly.d3.csv("original_defects.csv", function(err, rows) {

        function unpack(rows, key) {
            return rows.map(function(row) {return row[key]; });
        }

        function filter_version_num(rows, num) {
            return rows.filter(function (row){
               if (row['version_number'] === num.toString())
                   return row;
            });
        }

        let version1_rows = filter_version_num(rows, 0);
        let version2_rows = filter_version_num(rows, 1);
        let version3_rows = filter_version_num(rows, 2);
        let version4_rows = filter_version_num(rows, 3);
        let version5_rows = filter_version_num(rows, 4);

        let version_defects1 = {
            x: unpack(version1_rows, "project"),
            y: unpack(version1_rows, "number_defects"),
            name: "v1 " + unpack(version1_rows, "purpose")[0] ,
            text: unpack(version1_rows, "version"),
            type: 'bar',
            marker: {
                color: "#0096c7"
            }
        };

        let version_defects2 = {
            x: unpack(version2_rows, "project"),
            y: unpack(version2_rows, "number_defects"),
            name: "v2 " + unpack(version2_rows, "purpose")[0] ,
            text: unpack(version2_rows, "version"),
            type: 'bar',
            marker: {
                color: "#0077b6"
            }
        };

        let version_defects3 = {
            x: unpack(version3_rows, "project"),
            y: unpack(version3_rows, "number_defects"),
            name: "v3 " + unpack(version3_rows, "purpose")[0],
            text: unpack(version3_rows, "version"),
            type: 'bar',
            marker: {
                color: "#023e8a"
            }
        };

        let version_defects4 = {
            x: unpack(version4_rows, "project"),
            y: unpack(version4_rows, "number_defects"),
            name: "v4 " + unpack(version4_rows, "purpose")[0],
            text: unpack(version4_rows, "version"),
            type: 'bar',
            marker: {
                color: "#03045e"
            }
        }

        let version_defects5 = {
            x: unpack(version5_rows, "project"),
            y: unpack(version5_rows, "number_defects"),
            name: "v5 " + unpack(version5_rows, "purpose")[0],
            text: unpack(version5_rows, "version"),
            type: 'bar',
            marker: {
                color: "#d62828",
            }

        }

        let data = [
            version_defects1,
            version_defects2,
            version_defects3,
            version_defects4,
            version_defects5];

        let layout = {
            title: 'Distribution of Defects between Versions',
            barmode: 'stack',
            font: {
                    family: "'Fira Code', monospace",
                    size: 8,
                    color: "#7f7f7f"
            },
            xaxis: {
                title: 'Projects',
                tickfont: {
                    size: 6
                }
            },
            yaxis: {
                title: 'Defects'
            },
            legend: {
                font: {
                    size: 3
                }
            }
        };

        Plotly.newPlot('myplot', data, layout);
    });
</script>